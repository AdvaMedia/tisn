var PeriodicalExecuter=new Class({initialize:function(b,a){this.callback=b;this.frequency=a;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.stop();this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000);return this},execute:function(){this.callback(this);return this},stop:function(){if(!this.timer){return this}clearInterval(this.timer);this.timer=null;return this},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute()}finally{this.currentlyExecuting=false}}return this}});(function(){function a(d,c){var e=d.getStyle(c);return e=="auto"?0:e.toInt()}var b=this.Carousel=new Class({Implements:[Options,Events],options:{link:"cancel",mode:"horizontal",animation:"Move",scroll:4,distance:1,fx:{link:"cancel",transition:"sine:out",duration:500}},plugins:{},initialize:function(c){this.addEvent("change",function(d){this.current=d}.bind(this)).setOptions(c);["previous","next"].each(function(d){if($(this.options[d])){$(this.options[d]).addEvent("click",function(f){f.stop();this[d]()}.bind(this))}},this);this.elements=$(c.container).getChildren(c.selector);this.current=0;this.anim=new this.plugins[this.options.animation](this);this.move(this.options.current||0)},isVisible:function(d){if($type($(d))=="element"){d=this.elements.indexOf($(d))}var f=this.elements.length,g=this.current,c=this.options.scroll;if(g<=d&&d<g+c){return true}if(this.options.circular){for(var e=1;e<c;e++){if((e+g)%f==d){return true}}}return false},first:function(){return this.current},previous:function(c){return this.move(this.current-this.options.distance,c)},next:function(c){return this.move(this.current+this.options.distance,c)},move:function(e,i){var g=this.elements,h=this.current,f=g.length,c=this.options.scroll;if($type($(e))=="element"){e=g.indexOf($(e))}if(!this.options.circular){if(e>f-c){e=f-c}}else{if(e<0){e+=f}e%=Math.max(f,1)}if(e<0||f<=c||e>=f){return this}if(i==undefined){var d=h<e?e-h:g.length-h+e,j=h>e?h-e:h+g.length-e;i=Math.abs(d)<=Math.abs(j)?1:-1}this.anim.move(this,e,i);return this}});b.prototype.plugins.Move=new Class({initialize:function(g){var c=this.up=g.options.mode=="vertical",d=this.options=g.options,f=this.elements=g.elements,e=f[0].getParent();e.setStyles({height:f[0].setStyle("display","block").getStyle("height"),position:"relative",overflow:"hidden"}).getStyle("padding"+(this.up?"Top":"Left"));f.each(function(h){h.setStyles({display:"block",position:"absolute"})});this.property="offset"+(c?"Top":"Left");this.margin=c?["marginTop","marginBottom"]:["marginLeft","marginRight"];this.padding=a(e,c?"paddingTop":"paddingLeft");this.pad=a(e,"paddingLeft");this.reorder(0,1).fx=new Fx.Elements(f,d.fx).addEvents({onStart:function(){g.active=true},onComplete:function(){g.active=false}})},reorder:function(h,n){var o=this.options,l=this.elements,c,g,p=pos=this.padding,f=this.pad,j,k,e=l.length,d=o.mode=="horizontal",m=d?"offsetWidth":"offsetHeight";if(n==-1){for(j=e;j>o.scroll-1;j--){k=(j+h+e)%e;g=c;c=l[k];if(g){pos-=a(g,this.margin[0])}if(d){c.setStyle("left",pos)}else{c.setStyles({left:f,top:pos})}pos-=(c[m]+a(c,this.margin[1]))}pos=p+c[m]+a(c,this.margin[0]);for(j=1;j<o.scroll;j++){k=(j+h+e)%e;g=c;c=l[k];if(g){pos+=a(g,this.margin[1])}if(d){c.setStyle("left",pos)}else{c.setStyles({left:f,top:pos})}pos+=c[m]+a(c,this.margin[0])}}else{if(n==1){for(j=0;j<e;j++){k=(j+h+e)%e;g=c;c=l[k];if(d){c.setStyle("left",pos)}else{c.setStyles({left:f,top:pos})}pos+=c[m]+a(c,this.margin[0]);if(g){pos+=a(g,this.margin[1])}}}}return this},move:function(h,g,f){var e={},c=this.up,d=this.property,i;if(this.options.circular){this.reorder(h.current,f)}i=h.elements[g][d]-this.padding;h.elements.each(function(k,j){e[j]=c?{top:k[d]-i}:{left:k[d]-i}});this.fx.cancel().start(e).chain(function(){h.fireEvent("change",g)})}})})();Carousel.Extra=new Class({Extends:Carousel,Binds:["update","start","stop"],initialize:function(b){this.parent($merge({interval:10,delay:10},b));var a=this;["previous","next"].each(function(c){if($(a.options[c])){$(a.options[c]).addEvent("click",function(d){d.stop();if(a.running){a.stop().start.delay(a.options.delay*1000)}})}});this.reverse=!!this.options.reverse;this.running=false;this.timer=new PeriodicalExecuter(this.update,this.options.interval);return this},update:function(){return this[this.options.reverse?"previous":"next"]()},start:function(){this.timer.registerCallback();this.running=true;return this},stop:function(){this.timer.stop();this.running=false;return this}});